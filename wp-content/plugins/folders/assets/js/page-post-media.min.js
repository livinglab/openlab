!function(t){"use strict";var o=-1,a=0,s=0,i="",r=-1,l="",d=folders_media_options.page_url,n="",c="",m=!1,p=!1,f=!1,u=0,h=0,v=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var e={};folders_media_options.terms.length;_.each(folders_media_options.terms||{},function(t,o){e[t.term_id]={text:t.name+" ("+t.count+")",props:{media_folder:t.slug}}}),e.all={text:"All Folders",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e},change:function(){var e={};_.each(folders_media_options.terms||{},function(t,o){e[t.term_id]={text:t.name+" ("+t.count+")",props:{media_folder:t.slug}}}),e.all={text:"Select a folder >>",props:{media_folder:""},priority:10},e.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=e;var t=this.filters[this.el.value];t&&this.model.set(t.props)}}),g=(o=-1,0),x=0,y=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){y.prototype.createToolbar.call(this),this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new v({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var w,b=wp.media.model.Query;_.extend(b,{get:(w=[],function(e,t){var o,a={},s=b.orderby,i=b.defaultProps;return delete e.query,delete e.cache,_.defaults(e,i),_.each(["include","exclude"],function(t){e[t]&&!_.isArray(e[t])&&(e[t]=[e[t]])}),_.each(e,function(e,t){_.isNull(e)||(a[b.propmap[t]||t]=e)}),_.defaults(a,b.defaultArgs),a.orderby=s.valuemap[e.orderby]||e.orderby,w=[],o||(o=new b([],_.extend(t||{},{props:e,args:a})),w.push(o)),o})});var C=window.wp;void 0!==C&&"function"==typeof C.Uploader&&(C.media.view.Modal.prototype.on("open",function(){setTimeout(function(){t("#media-attachment-taxonomy-filter").length&&("all"==t("#media-attachment-taxonomy-filter").val()&&(t("#media-attachment-taxonomy-filter option:gt(1)").remove(),_.each(folders_media_options.terms,function(e,o){t("#media-attachment-taxonomy-filter").append("<option value='"+e.term_id+"'>"+e.name+" ("+e.count+")</option>")})),jQuery("#wcp-content").length||jQuery(".editor-post-featured-image").length&&jQuery(".attachment-filters").val("all").trigger("change"))},100)}),jQuery.extend(C.Uploader.prototype,{progress:function(){},init:function(){this.uploader&&(this.uploader.bind("FileFiltered",function(e,o){g++,t(".folder-meter").css("width","0%"),t(".media-folder-loader").show(),t("#total_upload_files").text(g)}),this.uploader.bind("BeforeUpload",function(e,a){var s=o,i=e.settings.multipart_params;if((s=parseInt(s))>0&&(i.folder_for_media=s),x<g){t(".media-folder-loader").show();var r=x/g*100;t(".folder-meter").css("width",r+"%")}x++,t("#current_upload_files").text(x)}),this.uploader.bind("UploadComplete",function(e,t){o=-1}),this.uploader.bind("UploadComplete",function(e,o){var a=window.wp;t(".folder-meter").css("width","100%"),setTimeout(function(){t(".media-folder-loader").hide(),t(".folder-meter").css("width","0%"),g=0,x=0},1250),S(),void 0!==a.media.frame&&null!==a.media.frame.content.get()?(a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):t("#media-attachment-taxonomy-filter").length&&t(".attachment-filters").each(function(){t(this).trigger("change")})}))}}));var k=window.wp;if(void 0!==k&&"function"==typeof k.Uploader){var j=window.wp.media,Q=j.view.Modal;j.view.Modal=j.view.Modal.extend({className:"folder-modal",initialize:function(){Q.prototype.initialize.apply(this,arguments)},open:function(){t(".folder-modal").removeClass("folder-modal"),Q.prototype.open.apply(this,arguments)&&(console.log("media frame open"),t(".folder-modal").length&&(t(".folder-custom-menu").remove(),t(".folder-modal .media-frame-tab-panel").removeClass("has-folder-menu"),t(".folder-modal .media-frame").hasClass("hide-menu")?t(".folder-custom-menu").length||(t(".folder-modal .media-frame-tab-panel").before("<div class='folder-custom-menu'><div class='folder-menu-content'></div></div>"),t(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",function(){D()})):t(".folder-custom-menu").length||(t(".folder-modal .media-frame-menu").addClass("has-folder-menu"),t(".folder-modal .media-frame-menu .media-menu").append("<div class='folder-custom-menu'><div class='folder-menu-content'></div></div>"),t(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",function(){D()})),t(".folder-form-data").remove(),t(".media-frame-tab-panel:first").before("<div class='folder-form-data'></div>"),t(".folder-form-data").load(folders_media_options.media_page_url+" #folder-add-update-content",function(){})))},close:function(){Q.prototype.close.apply(this,arguments),t(".folder-modal").removeClass("folder-modal")}})}function I(){if(t(".media-toolbar").hasClass("media-toolbar-mode-select")&&t("ul.attachments li.selected").length&&(t("ul.attachments li.selected").trigger("click"),t(".select-mode-toggle-button").trigger("click")),""!=c&&(t("#custom-menu li.active-item").length>0||"-1"==n)){if(t("#media-attachment-taxonomy-filter").length){c=c.split(",");for(var e=0;e<c.length;e++)""!=c[e]&&t(".media-frame:not(.hide-router) .attachments-browser li[data-id='"+c[e]+"']").remove()}c=""}t("#media-attachment-taxonomy-filter").length?J(0):(jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=get_folders_default_list",method:"post",success:function(o){o=jQuery.parseJSON(o);for(t(".header-posts .total-count").text(o.total_items),t(".un-categorised-items .total-count").text(o.empty_items),e=0;e<o.taxonomies.length;e++)t("#title_"+o.taxonomies[e].term_id+" .total-count").length||t("#title_"+o.taxonomies[e].term_id+" .star-icon").before("<span class='total-count'></span>"),t("#title_"+o.taxonomies[e].term_id+" .total-count").text(parseInt(o.taxonomies[e].trash_count)),t(".sticky-folders .sticky-folder-"+o.taxonomies[e].term_id+" .folder-count").length||t(".sticky-folders .sticky-folder-"+o.taxonomies[e].term_id+" a").append("<span class='folder-count'></span>"),t(".sticky-folders .sticky-folder-"+o.taxonomies[e].term_id+" .folder-count").text(parseInt(o.taxonomies[e].trash_count));t("#custom-menu .total-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()}),t(".sticky-folders .folder-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()})}}),t(".folder-loader-ajax").addClass("active"),t("#folder-posts-filter").length?t("#folder-posts-filter").load(d+" #posts-filter",function(){"show"!=folders_media_options.show_in_page||t(".tree-structure").length||t(".wp-header-end").before('<div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div>'),add_active_item_to_list(),triggerInlineUpdate()}):t("#wpbody").load(d+" #wpbody-content",!1,function(e){"show"!=folders_media_options.show_in_page||t(".tree-structure").length||t(".wp-header-end").before('<div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div>'),add_active_item_to_list()}))}function S(){var e=t("#media-attachment-taxonomy-filter").val();jQuery.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",success:function(o){o=jQuery.parseJSON(o);if(t("#media-attachment-taxonomy-filter").length){if(t("#media-attachment-taxonomy-filter").each(function(){folders_media_options.terms=o.taxonomies;var a=t(this);a.html("<option value='all'>All Folders</option><option value='unassigned'>(Unassigned)</option>"),o.taxonomies;for(var s=0;s<o.taxonomies.length;s++)a.append("<option value='"+o.taxonomies[s].term_id+"'>"+o.taxonomies[s].name+" ("+o.taxonomies[s].count+")</option>");a.val(e).trigger("change")}),t("select.folder_for_media").length){var a=t("select.folder_for_media").val();t("select.folder_for_media option:not(:first-child):not(:last-child)").remove();for(var s=0;s<o.taxonomies.length;s++)t("select.folder_for_media option:last-child").before("<option value='"+o.taxonomies[s].term_id+"'>"+o.taxonomies[s].name+"</option>");""!=a&&t(".folder_for_media").val(a)}for(s=0;s<o.taxonomies.length;s++)t("#title_"+o.taxonomies[s].term_id+" .total-count").length||t("#title_"+o.taxonomies[s].term_id+" .star-icon").before("<span class='total-count'></span>"),t("#title_"+o.taxonomies[s].term_id+" .total-count").text(parseInt(o.taxonomies[s].trash_count)),t(".sticky-folders .sticky-folder-"+o.taxonomies[s].term_id+" .folder-count").length||t(".sticky-folders .sticky-folder-"+o.taxonomies[s].term_id+" a").append("<span class='folder-count'></span>"),t(".sticky-folders .sticky-folder-"+o.taxonomies[s].term_id+" .folder-count").text(parseInt(o.taxonomies[s].trash_count)),t("#title_"+o.taxonomies[s].term_id).attr("title",o.taxonomies[s].term_name),t("#title_"+o.taxonomies[s].term_id+" .title-text").html(o.taxonomies[s].term_name);t("#custom-menu .total-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()}),t(".sticky-folders .folder-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()})}}})}function N(){if(""!=t.trim(t("#folder-search").val())){t("#custom-menu").addClass("has-filter");var e=t.trim(t("#folder-search").val()).toLowerCase();t("#custom-menu span.title-text").removeClass("has-search-text"),t("li.route").removeClass("has-search"),t("#custom-menu span.title-text").each(function(){-1!==t(this).text().toLowerCase().indexOf(e)&&(t(this).addClass("has-search-text"),t(this).parents("li.route").addClass("has-search"))})}else t("#custom-menu").removeClass("has-filter"),t("#custom-menu span.title-text").removeClass("has-search-text"),t("li.route").removeClass("has-search")}function P(e){var o="Are you sure you want to delete the selected folder?",a="Items in the folder will not be deleted.";if(m=!1,1==e&&t("#folder-hide-show-checkbox").is(":checked")){if(m=!0,0==t("#custom-menu input.checkbox:checked").length)return t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html("Please select at least one folder to delete"),void t("#error-folder-popup").show();t("#custom-menu input.checkbox:checked").length>1&&(o="Are you sure you want to delete the selected folders?",a="Items in the selected folders will not be deleted.")}t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#remove-folder-item").text("Yes, Delete it!"),t("#remove-folder-message").text(o),t("#remove-folder-notice").text(a),t("#confirm-remove-folder").show(),t("#remove-folder-item").focus()}function A(){var e=t.trim(t("#wcp_folder_"+s+" > h3 > .title-text").text()),o=t("#wcp_folder_"+s).closest("li.route").data("folder-id");null==o&&(o=0),t(".dynamic-menu").hide(),t("#update-folder-data").text("Submit"),t(".folder-form-errors").removeClass("active"),t("#update-folder-item-name").val(e),t("#update-folder-item").removeClass("disabled"),t("#update-folder-item").show(),t("#update-folder-item-name").focus()}function O(){if(0==parseInt(folders_media_options.is_key_active)&&r>=10)return t("#folder-limitation-message").html("You've reached the 10 folder limitation!"),t("#no-more-folder-credit").show(),!1;t("#add-update-folder-title").text("Add new folder"),t("#save-folder-data").text("Submit"),t(".folder-form-errors").removeClass("active"),t("#add-update-folder-name").val(""),f&&(u=s,t("#add-update-folder-name").val(t("#title_"+s+" .title-text").text()+" #2"),s=t("li#wcp_folder_"+s).parent().hasClass("first-space")?0:t("li#wcp_folder_"+s).parent().parent().data("folder-id")),h=t("#space_"+s+" > li").length+1,folders_media_options.ajax_url+"?parent_id="+s+"&type="+folders_media_options.post_type+"&action=wcp_add_new_folder&nonce="+folders_media_options.nonce+"&term_id="+s+"&order="+h+"&name=",t("#add-update-folder").removeClass("disabled"),t("#add-update-folder").show(),t("#add-update-folder-name").focus()}function D(){t("#custom-menu .has-sub-tree").length==t("#custom-menu .has-sub-tree.active").length&&t("#custom-menu .has-sub-tree").length?(t("#expand-collapse-list").addClass("all-open"),t("#expand-collapse-list").attr("data-folder-tooltip","Collapse")):(t("#expand-collapse-list").removeClass("all-open"),t("#expand-collapse-list").attr("data-folder-tooltip","Expand"))}function J(e){jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_get_default_list&active_id="+n,method:"post",success:function(e){e=jQuery.parseJSON(e),t(".header-posts .total-count").text(e.total_items),t(".un-categorised-items .total-count").text(e.empty_items);var o=t("#media-attachment-taxonomy-filter").val();if("all"!=o){var a=parent.wp;null!=a.media&&(a.media.frame.setState("insert"),null!==a.media.frame.content.get()?(a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):a.media.frame.library.props.set({ignore:+new Date}))}if(e.taxonomies.length){if(t("#media-attachment-taxonomy-filter").length){folders_media_options.terms=e.taxonomies;var i=t("#media-attachment-taxonomy-filter");i.html("<option value='all'>All Folders</option><option value='unassigned'>(Unassigned)</option>"),t(".media-select-folder").html("<option value=''>Select Folder</option><option value='-1'>(Unassigned)</option>");for(var r=0;r<e.taxonomies.length;r++)i.append("<option value='"+e.taxonomies[r].term_id+"'>"+e.taxonomies[r].name+" ("+e.taxonomies[r].trash_count+")</option>"),t(".media-select-folder").append("<option value='"+e.taxonomies[r].term_id+"'>"+e.taxonomies[r].name+" ("+e.taxonomies[r].trash_count+")</option>"),t("#title_"+e.taxonomies[r].term_id).attr("title",e.taxonomies[r].term_name),t("#title_"+e.taxonomies[r].term_id+" .title-text").html(e.taxonomies[r].term_name);i.val(o),t(".media-select-folder").val("")}if(t("select.folder_for_media").length){o=t("select.folder_for_media").val(),t("select.folder_for_media option:not(:first-child):not(:last-child)").remove();for(r=0;r<e.taxonomies.length;r++)t("select.folder_for_media option:last-child").before("<option value='"+e.taxonomies[r].term_id+"'>"+e.taxonomies[r].name+"</option>");""!=o&&t(".folder_for_media").val(o)}for(r=0;r<e.taxonomies.length;r++)t("#title_"+e.taxonomies[r].term_id+" .total-count").length||t("#title_"+e.taxonomies[r].term_id+" .star-icon").before("<span class='total-count'></span>"),t("#title_"+e.taxonomies[r].term_id+" .total-count").text(parseInt(e.taxonomies[r].trash_count)),t(".sticky-folders .sticky-folder-"+e.taxonomies[r].term_id+" .folder-count").length||t(".sticky-folders .sticky-folder-"+e.taxonomies[r].term_id+" a").append("<span class='folder-count'></span>"),t(".sticky-folders .sticky-folder-"+e.taxonomies[r].term_id+" .folder-count").text(parseInt(e.taxonomies[r].trash_count)),t("#title_"+e.taxonomies[r].term_id).attr("title",e.taxonomies[r].term_name),t("#title_"+e.taxonomies[r].term_id+" .title-text").html(e.taxonomies[r].term_name);t("#custom-menu .total-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()}),t(".sticky-folders .folder-count").each(function(){0==parseInt(t(this).text())&&t(this).remove()})}""!=n&&t("#wcp_folder_"+n).addClass("active-item"),p&&(t("#title_"+s).trigger("click"),p=!1)}})}function F(){t(".folder-loader-ajax").addClass("active"),t(".folder-loader-ajax img").removeClass("active"),t(".folder-loader-ajax svg#successAnimation").addClass("active").addClass("animated"),setTimeout(function(){t(".folder-loader-ajax").removeClass("active"),t(".folder-loader-ajax img").addClass("active"),t(".folder-loader-ajax svg#successAnimation").removeClass("active").removeClass("animated")},2e3)}t(document).ready(function(){parseInt(folders_media_options.is_key_active),r=parseInt(folders_media_options.folders),t(document).on("click",".header-posts a.all-posts",function(e){s=0,n="",t(".active-item").removeClass("active-item"),t(this).addClass("active-item"),t(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("all").trigger("change"),t(this).closest(".media-frame").find(".folder_for_media").val("all").trigger("change")}),t(document).on("click",".un-categorised-items",function(e){s=0,n="",t(".active-item").removeClass("active-item"),t(this).addClass("active-item"),t(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("unassigned").trigger("change"),t(this).closest(".media-frame").find(".folder_for_media").val("-1").trigger("change")}),t(document).on("click","h3.title",function(e){s=t(this).closest("li.route").data("folder-id"),n=s,t(".active-item").removeClass("active-item"),t(this).closest("li.route").addClass("active-item"),t(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val(s).trigger("change"),t(this).closest(".media-frame").find(".folder_for_media").val(s).trigger("change")}),t(document).on("change",".folder_for_media",function(){"add-folder"!=t(this).val()&&null!=t(this).val()?o=t(this).val():"add-folder"==t(this).val()&&(o=-1)}),t(document).on("click",".update-inline-record",function(e){e.stopPropagation();var o=t(this).closest("li.route").hasClass("is-high");t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu");var a="<div class='dynamic-menu'><ul><li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span> New Folder</a></li><li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span> Rename</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Pro)</a></li><li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(o?" Remove Star":"Add a Star")+"</a></li><li class='duplicate-folder'><a href='javascript:;'><span class=''><i class='pfolder-clone'></i></span> Duplicate folder</a></li>",s=parseInt(t(this).closest("li.route").find("h3.title:first > .total-count").text());"attachment"==folders_media_options.post_type&&s&&(a+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span> Download Zip (Pro)</a></li>"),a+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span> Delete</a></li></ul></div>",t(this).closest("h3.title").after(a),t(this).parents("li.route").addClass("active-menu"),t(this).closest("h3.title").offset().top+t(".dynamic-menu").height()>t(window).height()-20&&(t(".dynamic-menu").addClass("bottom-fix"),t(".dynamic-menu.bottom-fix").offset().top<t("#custom-scroll-menu").offset().top&&t(".dynamic-menu").removeClass("bottom-fix"))}),t(document).on("click","body, html",function(e){t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu"),t(".folder-order").removeClass("active")}),t(document).on("click",".dynamic-menu, .folder-order",function(e){e.stopPropagation()}),t(document).on("contextmenu","h3.title",function(){if(e.preventDefault(),0==folders_media_options.can_manage_folder)return!1;var o=t(this).closest("li.route").hasClass("is-high");t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu");var a="<div class='dynamic-menu'><ul><li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span> New Folder</a></li><li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span> Rename</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Pro)</a></li><li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(o?" Remove Star":"Add a Star")+"</a></li><li class='duplicate-folder'><a href='javascript:;'><span class=''><i class='pfolder-clone'></i></span> Duplicate folder</a></li>",s=parseInt(t(this).closest("li.route").find("h3.title:first > .total-count").text());return"attachment"==folders_media_options.post_type&&s&&(a+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span> Download Zip (Pro)</a></li>"),a+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span> Delete</a></li></ul></div>",t(this).after(a),t(this).parents("li.route").addClass("active-menu"),t(this).offset().top+t(".dynamic-menu").height()>t(window).height()-20&&(t(".dynamic-menu").addClass("bottom-fix"),t(".dynamic-menu.bottom-fix").offset().top<t("#custom-scroll-menu").offset().top&&t(".dynamic-menu").removeClass("bottom-fix")),!1}),t(document).on("click",".new-folder",function(e){e.stopPropagation(),t(".active-menu").removeClass("active-menu"),s=t(this).closest("li.route").data("folder-id"),t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu"),p=!1,f=!1,O()}),t(document).on("click","#add-new-folder",function(e){s=t("#custom-menu li.active-item").length?t("#custom-menu li.active-item").data("folder-id"):0,p=!1,O()}),t(document).on("submit","#save-folder-form",function(e){if(e.stopPropagation(),e.preventDefault(),i=t("#add-update-folder-name").val(),""==t.trim(i))t(".folder-form-errors").addClass("active"),t("#add-update-folder-name").focus();else{t("#save-folder-data").html('<span class="dashicons dashicons-update"></span>'),t("#add-update-folder").addClass("disabled");var o="parent_id="+s+"&type="+folders_media_options.post_type+"&action=wcp_add_new_folder&nonce="+folders_media_options.nonce+"&term_id="+s+"&order="+h+"&name="+i+"&is_duplicate="+f+"&duplicate_from="+u;p&&(o="parent_id=0&type="+folders_media_options.post_type+"&action=wcp_add_new_folder&nonce="+folders_media_options.nonce+"&term_id=0&order="+h+"&name="+i+"&is_duplicate="+f+"&duplicate_from="+u),jQuery.ajax({url:folders_media_options.ajax_url,data:o,method:"post",success:function(e){var o=jQuery.parseJSON(e);"1"==o.status?(t("#space_"+o.parent_id).append(o.term_data),t("#wcp_folder_"+o.parent_id).addClass("active has-sub-tree"),parseInt(o.is_key_active),r=parseInt(o.folders),t("#current-folder").text(r),t("#ttl-fldr").text(10),D(),t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),F(),s=o.term_id,J(0)):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(o.message),t("#error-folder-popup").show())}})}return!1}),t(document).on("click",".form-cancel-btn",function(){t(".folder-popup-form").hide()}),t(document).on("click",".folder-popup-form",function(e){t(".folder-popup-form").hide()}),t(document).on("click",".popup-form-content",function(e){e.stopPropagation()}),document.onkeydown=function(e){("key"in(e=e||window.event)?"Escape"===e.key||"Esc"===e.key:27===e.keyCode)&&t(".folder-popup-form").hide()},t(document).on("click",".rename-folder",function(e){e.stopPropagation(),s=t(this).closest("li.route").data("folder-id"),A()}),t(document).on("click","#inline-update",function(e){t("#custom-menu li.active-item").length&&(s=t("#custom-menu li.active-item").data("folder-id"),A())}),t(document).on("submit","#update-folder-form",function(e){if(e.stopPropagation(),e.preventDefault(),t(".dynamic-menu").hide(),i=t("#update-folder-item-name").val(),""==t.trim(i))t(".folder-form-errors").addClass("active"),t("#update-folder-item-name").focus();else{t("#update-folder-data").html('<span class="dashicons dashicons-update"></span>'),t("#update-folder-item").addClass("disabled"),l=t.trim(t("#wcp_folder_"+s).data("rename"));var o=t("#wcp_folder_"+s).closest("li.route").data("folder-id");null==o&&(o=0),jQuery.ajax({url:folders_media_options.ajax_url,data:"parent_id="+o+"&nonce="+l+"&type="+folders_media_options.post_type+"&action=wcp_update_folder&term_id="+s+"&name="+i,method:"post",success:function(e){var o=jQuery.parseJSON(e);"1"==o.status?(t("#wcp_folder_"+o.id+" > h3 > .title-text").text(o.term_title),t("#wcp_folder_"+o.id+" > h3").attr("title",o.term_title),t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),F(),J(0)):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(o.message),t("#error-folder-popup").show())}})}return!1}),t(document).on("click",".mark-folder",function(e){e.stopPropagation(),a=t(this).closest("li.route").data("folder-id"),l=t.trim(t("#wcp_folder_"+a).data("star")),t(".form-loader-count").css("width","100%"),t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu"),jQuery.ajax({url:folders_media_options.ajax_url,data:"term_id="+a+"&type="+folders_media_options.post_type+"&action=wcp_mark_un_mark_folder&nonce="+l,method:"post",cache:!1,success:function(e){e=jQuery.parseJSON(e);t(".form-loader-count").css("width","0%"),"1"==e.status?("1"==e.marked?t("#wcp_folder_"+e.id).addClass("is-high"):t("#wcp_folder_"+e.id).removeClass("is-high"),F()):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show())}})}),t(document).on("click",".duplicate-folder",function(e){e.stopPropagation(),t(".active-menu").removeClass("active-menu"),s=t(this).closest("li.route").data("folder-id"),t(".dynamic-menu").remove(),f=!0,O()}),t(document).on("click",".remove-folder",function(e){a=t(this).closest("li.route").data("folder-id"),s=a,P(0),t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu")}),t(document).on("click","#remove-folder-item",function(e){e.stopPropagation(),t(".folder-popup-form").addClass("disabled"),t("#remove-folder-item").html('<span class="dashicons dashicons-update"></span>'),l=t.trim(t("#wcp_folder_"+s).data("delete")),m?function(){if(t("#folder-hide-show-checkbox").is(":checked")&&t("#custom-menu input.checkbox:checked").length>0){var e="";t("#custom-menu input.checkbox:checked").each(function(){e+=t(this).val()+",",t(this).closest("li.route").hasClass("active-item")&&!0}),t(".form-loader-count").css("width","100%"),jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_muliple_folder&term_id="+e+"&nonce="+folders_media_options.nonce,method:"post",success:function(e){var e=jQuery.parseJSON(e);t(".form-loader-count").css("width","0px"),"1"==e.status?(parseInt(e.is_key_active),r=parseInt(e.folders),t("#current-folder").text(r),t("#custom-menu input.checkbox:checked").each(function(){t("#wcp_folder_"+t(this).val()).closest("li.route").remove(),t("#space"+t(this).val()).remove()}),t("#ttl-fldr").text(10),F(),t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),I(),F(),t("#wcp_folder_"+n).length||(t(".header-posts a").trigger("click"),n=0)):window.location.reload(),t("#folder-hide-show-checkbox").attr("checked",!1),t("#custom-menu input.checkbox").attr("checked",!1),t("#custom-menu").removeClass("show-folder-checkbox")}})}}():jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_folder&term_id="+s+"&nonce="+l,method:"post",success:function(e){"1"==(e=jQuery.parseJSON(e)).status?(t("#wcp_folder_"+s).remove(),t("#folder_"+s).remove(),parseInt(e.is_key_active),r=parseInt(e.folders),t("#current-folder").text(r),t("#ttl-fldr").text(10),F(),t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),n==s&&jQuery(".header-posts a").trigger("click"),S()):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show())}})}),t(document).on("click","#sort-order-list",function(e){e.stopPropagation(),t(".folder-order").toggleClass("active")}),t(document).on("click","#expand-collapse-list",function(e){e.stopPropagation();var o=0;t(this).hasClass("all-open")?(t(this).removeClass("all-open"),t(".has-sub-tree").removeClass("active"),o=0,t(this).attr("data-folder-tooltip","Expand")):(t(this).addClass("all-open"),o=1,t(".has-sub-tree").addClass("active"),t(this).attr("data-folder-tooltip","Collapse")),c="",t(".has-sub-tree").each(function(){c+=t(this).data("folder-id")+","}),""!=c&&(t(".form-loader-count").css("width","100%"),l=folders_media_options.nonce,jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_change_all_status&status="+o+"&folders="+c+"&nonce="+l,method:"post",success:function(e){t(".form-loader-count").css("width","0"),"0"==(e=jQuery.parseJSON(e)).status&&(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show(),window.location.reload(!0))}}))}),t(document).on("click",".folder-sort-menu a",function(e){e.stopPropagation(),e.preventDefault(),t(".form-loader-count").css("width","100%"),t(".folder-order").removeClass("active"),t(this).attr("data-sort"),jQuery.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_folders_by_order&nonce="+folders_media_options.nonce+"&order="+t(this).attr("data-sort"),method:"post",success:function(e){1==(e=jQuery.parseJSON(e)).status&&t("#space_0").html(e.data),t(".form-loader-count").css("width","0")}})}),t(".space").livequery(function(){t(this).sortable({placeholder:"ui-state-highlight",connectWith:".space",tolerance:"intersect",over:function(e,t){},update:function(e,o){o.item.context.attributes["data-folder-id"].nodeValue;var a="";t(this).children().each(function(){t(this).hasClass("route")&&(a+=t(this).data("folder-id")+",")}),""!=a&&(t(".form-loader-count").css("width","100%"),jQuery.ajax({url:folders_media_options.ajax_url,data:"term_ids="+a+"&action=wcp_save_folder_order&type="+folders_media_options.post_type+"&nonce="+folders_media_options.nonce,method:"post",success:function(e){"1"==(e=jQuery.parseJSON(e)).status?(t("#wcp_folder_parent").html(e.options),t(".form-loader-count").css("width","0"),I(),F()):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show(),window.location.reload(!0))}}))},receive:function(e,o){!function e(o){var a=t(o).siblings(".space").children(".route").children(".title");t(a).each(function(a,s){var i=parseInt(t(o).css("width")),r=parseInt(t(o).siblings(".space").css("margin-left")),l=i-r;"title_0"==t(o).attr("id")&&(l-=10),t(s).css({width:l}),e(s)})}(t(this).siblings(".title")),t(this).closest("li.route").addClass("active"),t(this).closest("li.route").find("ul.ui-sortable:first-child > li").slideDown();var a=t(this).closest("li.route").data("folder-id"),s=o.item.context.attributes["data-folder-id"].nodeValue;null==a&&(a=0);t("#wcp_folder_"+a+" .ui-sortable li").length?t("#wcp_folder_"+a+" .ui-sortable li").each(function(){t(this).data("folder-id")+","}):0==a&&t("#custom-menu > ul.space > li").each(function(){t(this).data("folder-id")+","}),t(".form-loader-count").css("width","100%"),l=t.trim(t("#wcp_folder_"+s).data("nonce")),jQuery.ajax({url:folders_media_options.ajax_url,data:"term_id="+s+"&action=wcp_update_parent_information&parent_id="+a+"&type="+folders_media_options.post_type+"&nonce="+l,method:"post",success:function(e){t(".form-loader-count").css("width","0%"),0==(e=jQuery.parseJSON(e)).status?(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show()):F()}})}}),t(this).disableSelection()}),t("h3.title").livequery(function(){t(this).droppable({accept:".wcp-move-file, .wcp-move-multiple, .media-frame:not(.hide-router) .attachments-browser li.attachment",hoverClass:"wcp-drop-hover",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(e,o){if(a=t(this).closest("li.route").data("folder-id"),o.draggable.hasClass("wcp-move-multiple")){if(t(".wp-list-table input:checked").length){var s="";t(".wp-list-table input:checked").each(function(){s+=t(this).val()+","}),l=t.trim(t("#wcp_folder_"+a).data("nonce")),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){"1"==(e=jQuery.parseJSON(e)).status?(I(),F()):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show())}})}}else if(o.draggable.hasClass("wcp-move-file")){var i=o.draggable[0].attributes["data-id"].nodeValue;l=t.trim(t("#wcp_folder_"+a).data("nonce")),s=i+",",t(".wp-list-table input:checked").each(function(){t(this).val()!=i&&(s+=t(this).val()+",")}),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){"1"==(e=jQuery.parseJSON(e)).status?(I(),F()):(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(e.message),t("#error-folder-popup").show())}})}else if(o.draggable.hasClass("attachment")){s=o.draggable[0].attributes["data-id"].nodeValue;l=t.trim(t("#wcp_folder_"+a).data("nonce")),t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length>1&&(s="",t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").each(function(){s+=t(this).data("id")+","})),c=s,jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}}})}),t(".media-frame:not(.hide-router) .attachments-browser li.attachment").livequery(function(){t(this).draggable({revert:"invalid",containment:"document",helper:function(e,o){t(".selected-items").remove();var a=t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length;return t("<div class='selected-items'><span class='total-post-count'>"+(a=0==a||1==a?"1 Item":a+" Items")+" Selected</span></div>")},start:function(e,o){t("body").addClass("no-hover-css")},cursor:"move",appendTo:".media-modal",cursorAt:{left:0,top:0},stop:function(e,o){t(".selected-items").remove(),t("body").removeClass("no-hover-css")}})}),t(".un-categorised-items").livequery(function(){t(this).droppable({accept:".wcp-move-file, .wcp-move-multiple, .media-frame:not(.hide-router) .attachments-browser li.attachment",hoverClass:"wcp-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(e,o){if(a=-1,l=folders_media_options.nonce,o.draggable.hasClass("wcp-move-multiple")){if(t(".wp-list-table input:checked").length){var s="";t(".wp-list-table input:checked").each(function(){s+=t(this).val()+","}),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_id="+s+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}}else if(o.draggable.hasClass("wcp-move-file")){var i=o.draggable[0].attributes["data-id"].nodeValue;s=i+",";t(".wp-list-table input:checked").each(function(){i!=t(this).val()&&(s+=t(this).val()+",")}),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_id="+s+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}else if(o.draggable.hasClass("attachment")){s=o.draggable[0].attributes["data-id"].nodeValue;t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length>1&&(s="",t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").each(function(){s+=t(this).data("id")+","})),c=s,jQuery.ajax({url:folders_media_options.ajax_url,data:"post_id="+s+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}}})}),t(".tree-structure .folder-item").livequery(function(){t(this).droppable({accept:".wcp-move-file, .wcp-move-multiple, .media-frame:not(.hide-router) .attachments-browser li.attachment",hoverClass:"wcp-drop-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(e,o){if(t("body").removeClass("no-hover-css"),a=t(this).data("id"),o.draggable.hasClass("wcp-move-multiple")){if(l=t.trim(t("#wcp_folder_"+a).data("nonce")),t(".wp-list-table input:checked").length){var s="";t(".wp-list-table input:checked").each(function(){s+=t(this).val()+","}),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}}else if(o.draggable.hasClass("wcp-move-file")){var i=o.draggable[0].attributes["data-id"].nodeValue;l=t.trim(t("#wcp_folder_"+a).data("nonce"));s=i+",";t(".wp-list-table input:checked").each(function(){t(this).val()!=i&&(s+=t(this).val()+",")}),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}else if(o.draggable.hasClass("attachment")){s=o.draggable[0].attributes["data-id"].nodeValue;l=t.trim(t("#wcp_folder_"+a).data("nonce")),t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length>1&&(s="",t(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").each(function(){s+=t(this).data("id")+","})),jQuery.ajax({url:folders_media_options.ajax_url,data:"post_ids="+s+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+a+"&nonce="+l+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+n,method:"post",success:function(e){I(),F()}})}}})}),t(".wcp-move-file").livequery(function(){t(this).draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move",start:function(e,o){t(this).closest("td").addClass("wcp-draggable"),t("body").addClass("no-hover-css")},stop:function(e,o){t(this).closest("td").removeClass("wcp-draggable"),t("body").removeClass("no-hover-css")}})}),t(".wcp-move-multiple").livequery(function(){t(this).draggable({revert:"invalid",containment:"document",helper:function(e,o){t(".selected-items").remove();var a=t("#the-list th input:checked").length;return t(a>0?"<div class='selected-items'><span class='total-post-count'>"+(a=0==a||1==a?"1 Item":a+" Items")+" Selected</span></div>":"<div class='selected-items'><span class='total-post-count'>Select Items to move</span></div>")},start:function(e,o){t("body").addClass("no-hover-css")},cursor:"move",cursorAt:{left:0,top:0},stop:function(e,o){t(".selected-items").remove(),t("body").removeClass("no-hover-css")}})}),t(document).on("click",".nav-icon",function(){a=t(this).closest("li.route").data("folder-id");var e=1;e=t("#wcp_folder_"+a).hasClass("active")?0:1,t(".form-loader-count").css("width","100%"),l=t.trim(t("#wcp_folder_"+a).data("nonce")),D(),jQuery.ajax({url:folders_media_options.ajax_url,data:"is_active="+e+"&action=save_wcp_folder_state&term_id="+a+"&nonce="+l,method:"post",success:function(o){t(".form-loader-count").css("width","0"),"0"==(o=jQuery.parseJSON(o)).status?(t(".folder-popup-form").hide(),t(".folder-popup-form").removeClass("disabled"),t("#error-folder-popup-message").html(o.message),t("#error-folder-popup").show()):(t("#wcp_folder_"+a).hasClass("active")?(t("#wcp_folder_"+a).removeClass("active"),t("#wcp_folder_"+a).find("ul.ui-sortable:first-child > li").slideUp(),e=0):(t("#wcp_folder_"+a).addClass("active"),t("#wcp_folder_"+a).find("ul.ui-sortable:first-child > li").slideDown(),e=1),F())}})}),t(document).on("keyup","#folder-search",function(){N()}),t(document).on("change","#folder-search",function(){N()}),t(document).on("blur","#folder-search",function(){N()}),t(document).on("click","#folder-hide-show-checkbox",function(){t(this).is(":checked")?t("#custom-menu").addClass("show-folder-checkbox"):(t("#custom-menu input.checkbox").attr("checked",!1),t("#custom-menu").removeClass("show-folder-checkbox"))}),t(document).on("click","#inline-remove",function(){t("#custom-menu li.active-item").length?(s=t("#custom-menu li.active-item").data("folder-id"),P(1),t(".dynamic-menu").remove(),t(".active-menu").removeClass("active-menu")):t("#folder-hide-show-checkbox").is(":checked")&&(t(".dynamic-menu").remove(),P(1))})})}(jQuery,_);