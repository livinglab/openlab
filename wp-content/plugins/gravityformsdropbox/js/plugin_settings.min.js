window.GFDropboxSettings=null,function(s){GFDropboxSettings=function(){var i=this;this.init=function(){this.initialValues={appKey:this.getAppKey(),appSecret:this.getAppSecret()},this.pageURL=gform_dropbox_pluginsettings_strings.settings_url,this.bindAppKeyUpdate(),this.bindDeauthorize(),this.bindDisableCustomApp(),this.bindEnableCustomApp(),this.setupValidationIcons(),s("#tab_gravityformsdropbox #gform-settings-save").hide()},this.bindAppKeyUpdate=function(){s("input#customAppKey, input#customAppSecret").on("blur",this.checkAppKeyValidity)},this.bindDeauthorize=function(){s("#gform_dropbox_deauth_button").on("click",function(t){t.preventDefault(),s(this).attr("disabled","disabled"),s.ajax({async:!1,url:ajaxurl,dataType:"json",data:{action:"gfdropbox_deauthorize",nonce:gform_dropbox_pluginsettings_strings.nonce_deauthorize},success:function(t){t.success?window.location.href=i.pageURL:alert(t.data.message),s(this).removeAttr("disabled")}})})},this.bindDisableCustomApp=function(){s("#gform_dropbox_disable_customApp").on("click",function(t){t.preventDefault(),s("input#customAppEnable").val(""),s("#gform-settings-save").trigger("click")})},this.bindEnableCustomApp=function(){s("#gform_dropbox_enable_customApp").on("click",function(t){t.preventDefault(),s("input#customAppEnable").val("1"),s("#gform-settings-save").trigger("click")})},this.checkAppKeyValidity=function(){i.lockAppKeyFields(!0),i.resetAppKeyStatus(),s.ajax({url:ajaxurl,dataType:"json",type:"GET",data:{action:"gfdropbox_valid_app_key_secret",app_key:i.getAppKey(),app_secret:i.getAppSecret(),nonce:gform_dropbox_pluginsettings_strings.nonce_validation},success:function(t){t.success?i.setAppKeyStatus(t.success,t.data.auth_url):t.data&&alert(t.data.message),i.lockAppKeyFields(!1)}})},this.getAppKey=function(){return s("input#customAppKey").val()},this.getAppSecret=function(){return s("input#customAppSecret").val()},this.lockAppKeyFields=function(t){s("input#customAppKey, input#customAppSecret").prop("disabled",t)},this.resetAppKeyStatus=function(){s("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid")},this.setAppKeyStatus=function(t,e){!0===t&&(window.location.href=i.pageURL),!1===t&&s("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-remove fa-times gf_invalid"),!1!==t&&null!==t||(s("#gform_dropbox_auth_message").show(),s("#gform_dropbox_auth_button").hide())},this.setupValidationIcons=function(){0==s("#gaddon-setting-row-customAppKey .fa").length&&s(' <i class="fa"></i>').insertAfter(s("#customAppKey")),0==s("#gaddon-setting-row-customAppSecret .fa").length&&s('<i class="fa"></i>').insertAfter(s("#customAppSecret"))},this.init()},s(document).ready(GFDropboxSettings)}(jQuery);